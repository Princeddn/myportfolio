// Donn√©es CV int√©gr√©es directement
const cvData = {
    "nom": "Prince Noukounwoui",
    "localisation": "Rennes, Bretagne, France",
    "titre": "√âtudiant en Master 2 Ing√©nierie Durable des B√¢timents Communicants Intelligents (ISTIC Rennes)",
    "coordonnees": {
        "telephone": "0612719903",
        "email": "noukounwouiprince@gmail.com",
        "linkedin": "https://www.linkedin.com/in/prince-noukounwoui-ba1978217"
    },
    "resume": "Actuellement en alternance chez JEEDOM, je travaille sur l'int√©gration de solutions Smarthome, Smartbuilding et Smartcity, en mettant l'accent sur les technologies Zigbee et LoRaWAN. Mes t√¢ches incluent le choix et les tests de produits, la cr√©ation de dashboards √©nerg√©tiques, ainsi que le support d'installations GTB. Mes exp√©riences pr√©c√©dentes, notamment chez Qotto et Golf Business Company, m'ont permis de d√©velopper des comp√©tences solides en maintenance photovolta√Øque, analyse de donn√©es IoT et optimisation des infrastructures √©lectriques.",
    "competences": [
        "JavaScript",
        "Python",
        "ZigBee",
        "LoRa",
        "LoRaWAN",
        "GTB/GTC",
        "Analyse de donn√©es IoT",
        "Maintenance photovolta√Øque",
        "√âlectrotechnique",
        "QGIS / ArcGIS"
    ],
    "certifications": [
        "Certificat Solutions Victron Energy pour les t√©l√©coms",
        "LoRa et LoRaWAN pour l'Internet des Objets",
        "Analyse et d√©pannage √† distance par VRM"
    ],
    "experiences": [
        {
            "entreprise": "JEEDOM",
            "poste": "Alternant int√©grateur smarthome, smartbuilding et smartcity",
            "periode": "Septembre 2025 - Pr√©sent",
            "lieu": "Lyon, France",
            "missions": [
                "Choix et tests des produits (Zigbee & LoRaWAN)",
                "Int√©gration des d√©codeurs",
                "Appairage et r√©alisation de coffrets domotiques",
                "Cr√©ation de dashboards √©nerg√©tiques et widgets",
                "Suivi et support d'installations GTB",
                "Prise en main du KNX sur Jeedom"
            ],
            "details": {
                "technologies": ["Zigbee", "LoRaWAN", "KNX", "JavaScript", "PHP", "MySQL", "Docker"],
                "realisations": [
                    "D√©ployement de plus de 50 capteurs IoT dans diff√©rents b√¢timents",
                    "Cr√©ation de dashboards √©nerg√©tiques permettant une √©conomie de 15% sur la consommation",
                    "Formation de 12 techniciens sur les protocoles Zigbee et LoRaWAN",
                    "D√©veloppement de widgets personnalis√©s pour l'interface Jeedom"
                ],
                "defis": [
                    "Int√©gration de protocoles diff√©rents dans un seul √©cosyst√®me",
                    "Optimisation des performances des r√©seaux sans fil en environnement urbain",
                    "Cr√©ation d'interfaces utilisateur intuitives pour des non-techniciens"
                ],
                "environnement": "√âquipe de 8 personnes, m√©thodologie Agile, environnement Linux",
                "impact": "Am√©lioration de l'efficacit√© √©nerg√©tique de 15% sur les installations d√©ploy√©es"
            }
        },
        {
            "entreprise": "JEEDOM",
            "poste": "Stagiaire en int√©gration smarthome, smartbuilding et smartcity",
            "periode": "Mai 2025 - Ao√ªt 2025",
            "lieu": "Lyon, France",
            "missions": [
                "Choix et tests des produits (Zigbee & LoRaWAN)",
                "Int√©gration des d√©codeurs",
                "Appairage et r√©alisation de coffrets domotiques",
                "Cr√©ation de dashboards √©nerg√©tiques et widgets",
                "Suivi et support d'installations GTB",
                "Prise en main du KNX sur Jeedom"
            ],
            "details": {
                "technologies": ["Zigbee", "LoRaWAN", "KNX", "JavaScript", "HTML5", "CSS3"],
                "realisations": [
                    "Mise en place d'un r√©seau LoRaWAN de 25 capteurs sur un campus universitaire",
                    "D√©veloppement d'un dashboard temps r√©el pour le monitoring √©nerg√©tique",
                    "Documentation technique compl√®te des protocoles d'int√©gration",
                    "Tests de port√©e et d'interf√©rences sur 3 protocoles sans fil"
                ],
                "defis": [
                    "Apprentissage rapide des protocoles IoT industriels",
                    "Adaptation aux contraintes techniques des b√¢timents existants",
                    "Optimisation de la consommation des capteurs autonomes"
                ],
                "environnement": "Stage en √©quipe R&D, encadrement par des experts IoT",
                "impact": "Bases techniques solides qui ont permis la conversion en alternance"
            }
        },
        {
            "entreprise": "Qotto",
            "poste": "Stagiaire Analyste Junior ‚Äì Maintenance et Intervention Photovolta√Øque",
            "periode": "Avril 2023 - Ao√ªt 2023",
            "lieu": "Cotonou, B√©nin",
            "missions": [
                "Surveillance √† distance des kits solaires via plateforme IoT",
                "Maintenance pr√©ventive et curative √† distance",
                "Analyse des donn√©es de production et de charge",
                "Coordination des interventions terrain via Google Sheets"
            ],
            "details": {
                "technologies": ["Python", "Google Sheets API", "MQTT", "InfluxDB", "Grafana", "ThingSpeak"],
                "realisations": [
                    "Monitoring de 200+ installations solaires en temps r√©el",
                    "R√©duction de 30% du temps de diagnostic gr√¢ce √† l'analyse automatis√©e",
                    "Cr√©ation d'alertes automatiques pour 15 types de pannes",
                    "D√©veloppement d'un tableau de bord de performance √©nerg√©tique"
                ],
                "defis": [
                    "Gestion des connexions intermittentes en zone rurale",
                    "Diagnostic √† distance sans acc√®s physique aux installations",
                    "Formation des techniciens locaux aux outils num√©riques"
                ],
                "environnement": "Start-up, √©quipe internationale, travail en autonomie",
                "impact": "30% d'am√©lioration de l'efficacit√© de maintenance, 200+ foyers aliment√©s"
            }
        },
        {
            "entreprise": "Golf Business Company",
            "poste": "Charg√© d'√âtudes en Infrastructures √âlectriques",
            "periode": "Juillet 2022 - Mars 2023",
            "lieu": "Cotonou, B√©nin",
            "missions": [
                "Cartographie r√©seaux √©lectriques et traitement de donn√©es GPS (QGIS, ArcGIS)",
                "Plans g√©or√©f√©renc√©s pour optimisation d'infrastructures",
                "Rapports techniques (s√©curit√©, co√ªts, faisabilit√©)",
                "Contribution √† l'√©lectrification rurale"
            ]
        },
        {
            "entreprise": "ASEMI SA",
            "poste": "Technicien √âlectrotechnicien ‚Äì R√©seaux Basse Tension",
            "periode": "Avril 2022 - Juin 2022",
            "lieu": "Cotonou, B√©nin",
            "missions": [
                "Construction et d√©ploiement de r√©seaux BT souterrains",
                "Maintenance postes HT/BT",
                "Analyse de performances et supervision"
            ]
        },
        {
            "entreprise": "Songha√Ø Centre",
            "poste": "Technicien √âlectrotechnique",
            "periode": "Ao√ªt 2021 - Septembre 2021",
            "lieu": "Porto-Novo, B√©nin",
            "missions": [
                "Rebobinage de moteurs AC triphas√©s",
                "Installation et entretien d'√©quipements √©lectrotechniques",
                "Mise en place de proc√©dures de test et diagnostic"
            ]
        }
    ],
    "formation": [
        {
            "ecole": "Universit√© de Rennes 1",
            "diplome": "Master Ing√©nierie Durable des B√¢timents Communicants Intelligents",
            "periode": "Septembre 2024 - Juin 2026"
        },
        {
            "ecole": "Universit√© de Franche-Comt√©",
            "diplome": "Licence Ing√©nierie √©lectrique et √©nergie",
            "periode": "Septembre 2023 - Juin 2024"
        },
        {
            "ecole": "Esmer (√âcole Sup√©rieure des M√©tiers des √ânergies Renouvelables)",
            "diplome": "Licence professionnelle G√©nie √©lectrique et √©nergie renouvelable",
            "periode": "Novembre 2020 - Juin 2022"
        }
    ],
    "projets": [
        {
            "nom": "LoRaWAN Plug and Play",
            "periode": "Novembre 2024 - Aujourd'hui",
            "organisation": "Universit√© de Rennes",
            "description": "D√©veloppement d'une biblioth√®que Python pour d√©coder les trames LoRaWAN. Cette biblioth√®que permet d'extraire automatiquement les informations des capteurs (fabricant, mod√®le, donn√©es mesur√©es) et de reconna√Ætre les capteurs gr√¢ce √† l'analyse des trames. Elle est con√ßue pour faciliter la gestion et l'int√©gration des capteurs dans des syst√®mes IoT.",
            "competences": [
                "Internet of Things (IoT)",
                "Gestion des technologies de l'information",
                "Bases de donn√©es",
                "Network server",
                "LoRaWAN",
                "Processus de la qualit√©",
                "R√©seaux de capteurs sans fil",
                "Python (langage de programmation)",
                "Cloud",
                "Linux",
                "R√©seaux informatiques",
                "SSH",
                "Gestion d'√©quipe"
            ],
            "statut": "En cours",
            "type": "Acad√©mique"
        },
        {
            "nom": "Cr√©ation d'une mini station m√©t√©o avec Arduino",
            "periode": "Janvier 2022 - Aujourd'hui",
            "organisation": "Esmer (√âcole Sup√©rieure des M√©tiers des √ânergies Renouvelables)",
            "description": "Projet de mini station m√©t√©o avec Arduino, int√©grant des capteurs pour mesurer la vitesse du vent (an√©mom√®tre) et les pr√©cipitations (pluviom√®tre). Les donn√©es collect√©es sont affich√©es en temps r√©el sur un √©cran LCD, gr√¢ce √† une programmation optimis√©e en Arduino. Ce projet visait √† concevoir une solution compacte, efficace et accessible pour surveiller les conditions m√©t√©orologiques locales.",
            "competences": [
                "Internet of Things (IoT)",
                "Capteurs",
                "Arduino",
                "Processus de la qualit√©",
                "√âlectronique Embarqu√©",
                "√âlectronique",
                "Arduino IDE"
            ],
            "statut": "Fait",
            "type": "Acad√©mique"
        },
        {
            "nom": "Conception d'un logiciel de dimensionnement de syst√®me photovolta√Øque avec Python",
            "periode": "Janvier 2020 - Aujourd'hui",
            "organisation": "Projet personnel",
            "description": "D√©veloppement d'un logiciel complet pour le dimensionnement des syst√®mes photovolta√Øques. L'application permet de calculer la taille optimale des installations solaires en fonction des besoins √©nerg√©tiques, de l'irradiation solaire locale et des contraintes techniques. Interface graphique intuitive d√©velopp√©e en Python pour faciliter l'utilisation par les professionnels du secteur.",
            "competences": [
                "Processus de la qualit√©",
                "Python (langage de programmation)",
                "Conception d'interface graphique",
                "√ânergies renouvelables",
                "Dimensionnement photovolta√Øque"
            ],
            "statut": "En cours",
            "type": "Personnel"
        }
    ]
};

// Ic√¥nes pour les comp√©tences
const skillIcons = {
    'JavaScript': 'fab fa-js-square',
    'Python': 'fab fa-python',
    'ZigBee': 'fas fa-broadcast-tower',
    'LoRa': 'fas fa-wifi',
    'LoRaWAN': 'fas fa-network-wired',
    'GTB/GTC': 'fas fa-building',
    'Analyse de donn√©es IoT': 'fas fa-chart-line',
    'Maintenance photovolta√Øque': 'fas fa-solar-panel',
    '√âlectrotechnique': 'fas fa-bolt',
    'QGIS / ArcGIS': 'fas fa-map'
};

// Chargement du DOM
document.addEventListener('DOMContentLoaded', function() {
    initNavigation();
    populateContent(); // Appel direct √† populateContent
    initScrollAnimations();
    initSmoothScrolling();
    initContactForm();
    initMessaging();
    initCalendlyListeners();
});

// Navigation mobile
function initNavigation() {
    const hamburger = document.querySelector('.hamburger');
    const navMenu = document.querySelector('.nav-menu');
    const navLinks = document.querySelectorAll('.nav-link');

    hamburger.addEventListener('click', function() {
        hamburger.classList.toggle('active');
        navMenu.classList.toggle('active');
    });

    // Fermer le menu mobile lors du clic sur un lien
    navLinks.forEach(link => {
        link.addEventListener('click', function() {
            hamburger.classList.remove('active');
            navMenu.classList.remove('active');
        });
    });

    // Effet de navigation au scroll
    window.addEventListener('scroll', function() {
        const navbar = document.querySelector('.navbar');
        if (window.scrollY > 100) {
            navbar.style.background = 'rgba(255, 255, 255, 0.98)';
            navbar.style.boxShadow = '0 2px 20px rgba(0, 0, 0, 0.1)';
        } else {
            navbar.style.background = 'rgba(255, 255, 255, 0.95)';
            navbar.style.boxShadow = 'none';
        }
    });
}

// Fonction supprim√©e - les donn√©es sont maintenant int√©gr√©es directement

// Remplissage du contenu avec les donn√©es JSON
function populateContent() {
    // Informations principales
    document.getElementById('nom-titre').textContent = cvData.nom;
    document.getElementById('titre-professionnel').textContent = cvData.titre;
    document.getElementById('localisation').textContent = `üìç ${cvData.localisation}`;
    document.getElementById('resume-text').textContent = cvData.resume;

    // Statistiques
    document.getElementById('nb-experiences').textContent = cvData.experiences.length;
    document.getElementById('nb-competences').textContent = cvData.competences.length;
    document.getElementById('nb-certifications').textContent = cvData.certifications.length;
    document.getElementById('nb-projets').textContent = cvData.projets.length;

    // Contact
    document.getElementById('email-contact').textContent = cvData.coordonnees.email;
    document.getElementById('telephone-contact').textContent = cvData.coordonnees.telephone;
    const linkedinLink = document.getElementById('linkedin-contact');
    linkedinLink.href = cvData.coordonnees.linkedin;
    linkedinLink.textContent = 'LinkedIn';

    // Sections dynamiques
    populateExperiences();
    populateCompetences();
    populateCertifications();
    populateFormation();
    populateProjects();

    // Animer les compteurs
    animateCounters();
}

// Remplissage des exp√©riences
function populateExperiences() {
    const timeline = document.getElementById('timeline-experiences');
    timeline.innerHTML = '';

    cvData.experiences.forEach((exp, index) => {
        const timelineItem = document.createElement('div');
        timelineItem.className = 'timeline-item fade-in';
        timelineItem.style.animationDelay = `${index * 0.2}s`;

        const missionsHTML = exp.missions.map(mission =>
            `<li>${mission}</li>`
        ).join('');

        timelineItem.innerHTML = `
            <div class="timeline-content">
                <h3>${exp.entreprise}</h3>
                <h4>${exp.poste}</h4>
                <div class="timeline-period">${exp.periode}</div>
                <div class="timeline-location">${exp.lieu}</div>
                <ul class="timeline-missions">
                    ${missionsHTML}
                </ul>
                <button class="btn-details" onclick="openExperienceDetails(${index})">
                    <i class="fas fa-eye"></i>
                    Voir les d√©tails
                </button>
            </div>
        `;

        timeline.appendChild(timelineItem);
    });
}

// Remplissage des comp√©tences
function populateCompetences() {
    const competencesGrid = document.getElementById('competences-grid');
    competencesGrid.innerHTML = '';

    cvData.competences.forEach((competence, index) => {
        const skillItem = document.createElement('div');
        skillItem.className = 'skill-item fade-in';
        skillItem.style.animationDelay = `${index * 0.1}s`;

        const icon = skillIcons[competence] || 'fas fa-code';

        skillItem.innerHTML = `
            <i class="${icon}"></i>
            <div class="skill-name">${competence}</div>
        `;

        competencesGrid.appendChild(skillItem);
    });
}

// Remplissage des certifications
function populateCertifications() {
    const certificationsGrid = document.getElementById('certifications-grid');
    certificationsGrid.innerHTML = '';

    cvData.certifications.forEach((certification, index) => {
        const certificationItem = document.createElement('div');
        certificationItem.className = 'certification-item fade-in';
        certificationItem.style.animationDelay = `${index * 0.2}s`;

        certificationItem.innerHTML = `
            <h3>${certification}</h3>
            <i class="fas fa-certificate" style="color: var(--accent-color); font-size: 1.5rem;"></i>
        `;

        certificationsGrid.appendChild(certificationItem);
    });
}

// Remplissage de la formation
function populateFormation() {
    const formationTimeline = document.getElementById('formation-timeline');
    formationTimeline.innerHTML = '';

    cvData.formation.forEach((formation, index) => {
        const timelineItem = document.createElement('div');
        timelineItem.className = 'timeline-item fade-in';
        timelineItem.style.animationDelay = `${index * 0.2}s`;

        timelineItem.innerHTML = `
            <div class="timeline-content">
                <h3>${formation.ecole}</h3>
                <h4>${formation.diplome}</h4>
                <div class="timeline-period">${formation.periode}</div>
            </div>
        `;

        formationTimeline.appendChild(timelineItem);
    });
}

// Remplissage des projets
function populateProjects() {
    const projectsGrid = document.getElementById('projets-grid');
    projectsGrid.innerHTML = '';

    cvData.projets.forEach((projet, index) => {
        const projectItem = document.createElement('div');
        projectItem.className = 'project-item fade-in';
        projectItem.style.animationDelay = `${index * 0.2}s`;

        // G√©n√©rer les badges de comp√©tences
        const competencesHTML = projet.competences.map(competence =>
            `<span class="skill-tag">${competence}</span>`
        ).join('');

        // D√©terminer l'ic√¥ne selon le type
        let projectIcon = 'fas fa-code';
        if (projet.type === 'Acad√©mique') {
            projectIcon = 'fas fa-university';
        } else if (projet.type === 'Personnel') {
            projectIcon = 'fas fa-user';
        }

        // D√©terminer la couleur du statut
        let statusClass = 'status-ongoing';
        if (projet.statut === 'Termin√©') {
            statusClass = 'status-completed';
        } else if (projet.statut === 'En pause') {
            statusClass = 'status-paused';
        }

        projectItem.innerHTML = `
            <div class="project-header">
                <div class="project-icon">
                    <i class="${projectIcon}"></i>
                </div>
                <div class="project-meta">
                    <div class="project-type">${projet.type}</div>
                    <div class="project-status ${statusClass}">${projet.statut}</div>
                </div>
            </div>
            <h3 class="project-title">${projet.nom}</h3>
            <div class="project-period">${projet.periode}</div>
            <div class="project-organization">${projet.organisation}</div>
            <p class="project-description">${projet.description}</p>
            <div class="project-skills">
                ${competencesHTML}
            </div>
        `;

        projectsGrid.appendChild(projectItem);
    });
}

// Animation des compteurs
function animateCounters() {
    const counters = document.querySelectorAll('.stat-number');

    const animateCounter = (counter) => {
        const target = parseInt(counter.textContent);
        const duration = 2000;
        const start = performance.now();

        const animate = (currentTime) => {
            const elapsed = currentTime - start;
            const progress = Math.min(elapsed / duration, 1);

            const easeOutCubic = 1 - Math.pow(1 - progress, 3);
            const current = Math.floor(easeOutCubic * target);

            counter.textContent = current;

            if (progress < 1) {
                requestAnimationFrame(animate);
            } else {
                counter.textContent = target;
            }
        };

        requestAnimationFrame(animate);
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                animateCounter(entry.target);
                observer.unobserve(entry.target);
            }
        });
    });

    counters.forEach(counter => {
        observer.observe(counter);
    });
}

// Animations au scroll
function initScrollAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, observerOptions);

    // Observer tous les √©l√©ments avec la classe fade-in
    const animatedElements = document.querySelectorAll('.fade-in, .slide-in-left, .slide-in-right');
    animatedElements.forEach(el => {
        observer.observe(el);
    });
}

// D√©filement fluide
function initSmoothScrolling() {
    const navLinks = document.querySelectorAll('.nav-link');

    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();

            const targetId = this.getAttribute('href').substring(1);
            const targetSection = document.getElementById(targetId);

            if (targetSection) {
                const offsetTop = targetSection.offsetTop - 80; // Hauteur de la navbar

                window.scrollTo({
                    top: offsetTop,
                    behavior: 'smooth'
                });
            }
        });
    });

    // Boutons hero
    const heroButtons = document.querySelectorAll('.hero-buttons a');
    heroButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            const href = this.getAttribute('href');
            if (href.startsWith('#')) {
                e.preventDefault();
                const targetId = href.substring(1);
                const targetSection = document.getElementById(targetId);

                if (targetSection) {
                    const offsetTop = targetSection.offsetTop - 80;

                    window.scrollTo({
                        top: offsetTop,
                        behavior: 'smooth'
                    });
                }
            }
        });
    });
}

// Formulaire de contact
function initContactForm() {
    const form = document.querySelector('.form');

    form.addEventListener('submit', function(e) {
        e.preventDefault();

        // Animation du bouton
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;

        submitBtn.textContent = 'Envoi en cours...';
        submitBtn.disabled = true;

        // Simuler l'envoi (remplacer par une vraie logique d'envoi)
        setTimeout(() => {
            submitBtn.textContent = 'Message envoy√©!';
            submitBtn.style.background = '#10b981';

            // R√©initialiser le formulaire
            form.reset();

            setTimeout(() => {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
                submitBtn.style.background = '';
            }, 3000);
        }, 2000);
    });
}

// Effet de parallaxe l√©ger sur le hero
window.addEventListener('scroll', () => {
    const scrolled = window.pageYOffset;
    const hero = document.querySelector('.hero');
    const heroContent = document.querySelector('.hero-content');

    if (hero && heroContent) {
        const rate = scrolled * -0.5;
        heroContent.style.transform = `translateY(${rate}px)`;
    }
});

// Gestion du redimensionnement de la fen√™tre
window.addEventListener('resize', () => {
    // R√©ajuster les animations si n√©cessaire
    const timeline = document.querySelector('.timeline');
    if (timeline && window.innerWidth <= 768) {
        // R√©ajustements pour mobile
        const timelineItems = document.querySelectorAll('.timeline-item');
        timelineItems.forEach(item => {
            item.style.left = '0';
            item.style.width = '100%';
        });
    }
});

// Effet de typing sur le titre
function typeWriter(element, text, speed = 100) {
    let i = 0;
    element.textContent = '';

    function type() {
        if (i < text.length) {
            element.textContent += text.charAt(i);
            i++;
            setTimeout(type, speed);
        }
    }

    type();
}

// Initialiser l'effet de typing une fois les donn√©es charg√©es
function initTypingEffect() {
    const titleElement = document.getElementById('nom-titre');
    if (titleElement && cvData) {
        setTimeout(() => {
            typeWriter(titleElement, cvData.nom, 150);
        }, 1000);
    }
}

// Th√®me sombre (optionnel)
function toggleTheme() {
    document.body.classList.toggle('dark-theme');
    localStorage.setItem('darkTheme', document.body.classList.contains('dark-theme'));
}

// Charger le th√®me sauvegard√©
function loadSavedTheme() {
    const savedTheme = localStorage.getItem('darkTheme');
    if (savedTheme === 'true') {
        document.body.classList.add('dark-theme');
    }
}

// Performance: Lazy loading des images (si ajout√©es plus tard)
function initLazyLoading() {
    if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.src = img.dataset.src;
                    img.classList.remove('lazy');
                    imageObserver.unobserve(img);
                }
            });
        });

        const images = document.querySelectorAll('img[data-src]');
        images.forEach(img => imageObserver.observe(img));
    }
}

// Fonction utilitaire pour d√©bugger
function debugPortfolio() {
    console.log('CV Data:', cvData);
    console.log('Viewport:', {
        width: window.innerWidth,
        height: window.innerHeight
    });
}

// Gestion des modals et inbox
function openInbox(type = 'chat') {
    const modal = document.getElementById('inbox-modal');
    const title = document.getElementById('inbox-title');

    // Personnaliser selon le type
    switch(type) {
        case 'linkedin':
            title.textContent = 'Message LinkedIn';
            break;
        case 'chat':
            title.textContent = 'Chat en direct';
            break;
        case 'direct':
            title.textContent = 'Message direct';
            break;
        default:
            title.textContent = 'Messagerie';
    }

    modal.classList.add('active');
    document.body.style.overflow = 'hidden';

    // Focus sur l'input de message
    setTimeout(() => {
        document.getElementById('message-input').focus();
    }, 300);
}

function closeInbox() {
    const modal = document.getElementById('inbox-modal');
    modal.classList.remove('active');
    document.body.style.overflow = 'auto';
}

// Initialisation des √©v√©nements Calendly
function initCalendlyListeners() {
    console.log('Initialisation des listeners Calendly');

    // √âcouter les √©v√©nements Calendly
    window.addEventListener('message', function(e) {
        if (e.data.event && e.data.event.indexOf('calendly') === 0) {
            console.log('Calendly event:', e.data.event);

            // Quand un √©v√©nement est planifi√©
            if (e.data.event === 'calendly.event_scheduled') {
                showNotification('Rendez-vous confirm√© ! Vous recevrez un email de confirmation.', 'success');

                // Optionnel: tracker l'√©v√©nement
                console.log('Event scheduled:', e.data.event_details);
            }
        }
    });
}

function openCalendly() {
    // Rediriger vers la nouvelle fonction Calendly
    openCalendlyWidget();
}

function closeCalendly() {
    // Plus besoin de modal, Calendly g√®re lui-m√™me
    console.log('Calendly popup closed');
}

// Syst√®me de messagerie
function sendMessage() {
    console.log('sendMessage() appel√©e');

    const input = document.getElementById('message-input');
    const messagesContainer = document.getElementById('messages-container');

    if (!input) {
        console.error('√âl√©ment message-input non trouv√©');
        return;
    }

    if (!messagesContainer) {
        console.error('√âl√©ment messages-container non trouv√©');
        return;
    }

    const message = input.value.trim();
    console.log('Message √† envoyer:', message);

    if (!message) {
        console.log('Message vide, arr√™t');
        return;
    }

    // Ajouter le message de l'utilisateur
    const userMessageDiv = document.createElement('div');
    userMessageDiv.className = 'message-item user-message';
    userMessageDiv.innerHTML = `
        <div class="avatar">
            <i class="fas fa-user"></i>
        </div>
        <div class="message-content">
            <p>${message}</p>
            <span class="message-time">${new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}</span>
        </div>
    `;

    messagesContainer.appendChild(userMessageDiv);

    // Effacer l'input
    input.value = '';

    // Scroll vers le bas
    messagesContainer.scrollTop = messagesContainer.scrollHeight;

    // Simuler une r√©ponse automatique apr√®s un d√©lai
    setTimeout(() => {
        addAutoReply(message);
    }, 1500);
}

function addAutoReply(userMessage) {
    const messagesContainer = document.getElementById('messages-container');

    // R√©ponse automatique principale
    let reply = "Merci pour votre message ! Pour une r√©ponse plus rapide et personnalis√©e, je vous invite √† me contacter directement via l'un de ces moyens :";

    // R√©ponses sp√©cifiques selon le contenu du message
    if (userMessage.toLowerCase().includes('rendez-vous') || userMessage.toLowerCase().includes('rencontrer')) {
        reply = "Je serais ravi de vous rencontrer ! Pour planifier un rendez-vous, vous pouvez :";
    } else if (userMessage.toLowerCase().includes('projet') || userMessage.toLowerCase().includes('collaboration')) {
        reply = "Excellent ! J'aimerais discuter de votre projet en d√©tail. Contactez-moi directement via :";
    } else if (userMessage.toLowerCase().includes('stage') || userMessage.toLowerCase().includes('alternance')) {
        reply = "Je suis toujours ouvert aux opportunit√©s int√©ressantes ! Pour discuter de cette opportunit√© :";
    } else if (userMessage.toLowerCase().includes('iot') || userMessage.toLowerCase().includes('domotique')) {
        reply = "Passionnant ! L'IoT et la domotique sont mes domaines de pr√©dilection. Parlons-en plus en d√©tail :";
    }

    const replyDiv = document.createElement('div');
    replyDiv.className = 'message-item';
    replyDiv.innerHTML = `
        <div class="avatar">
            <i class="fas fa-user-tie"></i>
        </div>
        <div class="message-content">
            <p><strong>Prince Noukounwoui</strong></p>
            <p>${reply}</p>
            <div class="contact-buttons">
                <button class="contact-btn linkedin-btn" onclick="contactViaLinkedIn()">
                    <i class="fab fa-linkedin"></i>
                    LinkedIn
                </button>
                <button class="contact-btn email-btn" onclick="contactViaEmail()">
                    <i class="fas fa-envelope"></i>
                    Email
                </button>
                <button class="contact-btn sms-btn" onclick="contactViaSMS()">
                    <i class="fas fa-sms"></i>
                    SMS
                </button>
                <button class="contact-btn appointment-btn" onclick="openCalendlyWidget()">
                    <i class="fas fa-calendar-alt"></i>
                    Rendez-vous
                </button>
            </div>
            <span class="message-time">${new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}</span>
        </div>
    `;

    messagesContainer.appendChild(replyDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

// Initialisation de la messagerie
function initMessaging() {
    console.log('Initialisation de la messagerie');

    const messageInput = document.getElementById('message-input');
    if (messageInput) {
        console.log('message-input trouv√©, ajout event listener');
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                console.log('Touche Entr√©e press√©e');
                sendMessage();
            }
        });
    } else {
        console.warn('message-input non trouv√© lors de l\'initialisation');
    }
}

// Fermer les modals en cliquant en dehors
document.addEventListener('click', function(e) {
    const inboxModal = document.getElementById('inbox-modal');
    const calendlyModal = document.getElementById('calendly-modal');
    const experienceModal = document.getElementById('experience-details-modal');

    if (e.target === inboxModal) {
        closeInbox();
    }

    if (e.target === calendlyModal) {
        closeCalendly();
    }

    if (e.target === experienceModal) {
        closeExperienceDetails();
    }
});

// Fermer les modals avec Escape
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeInbox();
        closeCalendly();
        closePhoneBooking();
        closeExperienceDetails();
    }
});

// Fermer le modal de booking en cliquant en dehors
document.addEventListener('click', function(e) {
    const phoneBookingModal = document.getElementById('phone-booking-modal');
    if (e.target === phoneBookingModal) {
        closePhoneBooking();
    }
});

// Syst√®me de r√©servation d'appels t√©l√©phoniques
let selectedSlot = null;
let bookingData = {};
let currentMonth = new Date();

// Configuration Calendly
const CALENDLY_CONFIG = {
    url: 'https://calendly.com/noukounwouiprince/30min',
    // Options de personnalisation Calendly
    options: {
        hideEventTypeDetails: false,
        hideLandingPageDetails: false,
        primaryColor: '007AFF',
        textColor: '1D1D1F'
    }
};

// R√®gles de disponibilit√©
const AVAILABILITY_RULES = {
    weekdaysOnly: true, // Pas de weekend
    startHour: 9,       // √Ä partir de 9h
    endHour: 18,        // Jusqu'√† 18h
    slotDuration: 30,   // Cr√©neaux de 30 minutes
    excludedDates: [],  // Dates √† exclure
    workingDays: [1, 2, 3, 4, 5], // Lun-Ven (0=Dimanche, 1=Lundi, etc.)
    // Plages de disponibilit√© par d√©faut (peut √™tre personnalis√©)
    timeSlots: [
        '09:00', '09:30', '10:00', '10:30', '11:00', '11:30',
        '14:00', '14:30', '15:00', '15:30', '16:00', '16:30', '17:00', '17:30'
    ]
};

// Cache pour les √©v√©nements
let eventsCache = {
    data: null,
    lastFetch: null,
    cacheDuration: 5 * 60 * 1000 // 5 minutes
};

// Ouvrir le widget Calendly
function openCalendlyWidget() {
    // V√©rifier que Calendly est charg√©
    if (typeof Calendly !== 'undefined') {
        Calendly.initPopupWidget({
            url: CALENDLY_CONFIG.url,
            ...CALENDLY_CONFIG.options
        });
    } else {
        // Fallback si Calendly n'est pas charg√©
        console.error('Calendly widget not loaded');
        showNotification('Erreur de chargement. Redirection vers Calendly...', 'warning');
        window.open(CALENDLY_CONFIG.url, '_blank');
    }
}

// Fonction legacy maintenue pour compatibilit√©
async function openPhoneBooking() {
    // Rediriger vers Calendly maintenant
    openCalendlyWidget();
}

function closePhoneBooking() {
    const modal = document.getElementById('phone-booking-modal');
    modal.classList.remove('active');
    document.body.style.overflow = 'auto';
}

function resetBookingForm() {
    selectedSlot = null;
    bookingData = {};

    // Afficher l'√©tape 1 et masquer les autres
    document.getElementById('step-1').classList.remove('hidden');
    document.getElementById('step-2').classList.add('hidden');
    document.getElementById('step-3').classList.add('hidden');
    document.getElementById('step-4').classList.add('hidden');
}

// Chargement des √©v√©nements depuis iCal
async function loadCalendarEvents() {
    const now = Date.now();

    // V√©rifier le cache
    if (eventsCache.data && eventsCache.lastFetch &&
        (now - eventsCache.lastFetch) < eventsCache.cacheDuration) {
        console.log('Utilisation du cache des √©v√©nements');
        return eventsCache.data;
    }

    try {
        console.log('Chargement des √©v√©nements depuis iCal...');

        // Utiliser un proxy CORS pour contourner les restrictions
        const icalUrl = CALENDAR_CONFIG.usePublicUrl ?
            CALENDAR_CONFIG.icalPublicUrl :
            CALENDAR_CONFIG.icalPrivateUrl;

        // Note: En production, vous devriez utiliser votre propre proxy CORS
        const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(icalUrl)}`;

        const response = await fetch(proxyUrl);
        if (!response.ok) {
            throw new Error(`Erreur HTTP: ${response.status}`);
        }

        const icalData = await response.text();
        const events = parseICalData(icalData);

        // Mettre √† jour le cache
        eventsCache.data = events;
        eventsCache.lastFetch = now;

        console.log(`${events.length} √©v√©nements charg√©s`);
        return events;

    } catch (error) {
        console.error('Erreur lors du chargement des √©v√©nements:', error);

        // En cas d'erreur, retourner une liste vide (mode d√©grad√©)
        showNotification('Impossible de charger les √©v√©nements. Mode d√©grad√© activ√©.', 'warning');
        return [];
    }
}

// Parser les donn√©es iCal
function parseICalData(icalString) {
    const events = [];
    const lines = icalString.split('\n');
    let currentEvent = null;

    for (let i = 0; i < lines.length; i++) {
        const line = lines[i].trim();

        if (line === 'BEGIN:VEVENT') {
            currentEvent = {};
        } else if (line === 'END:VEVENT' && currentEvent) {
            if (currentEvent.dtstart && currentEvent.dtend) {
                events.push({
                    start: parseICalDate(currentEvent.dtstart),
                    end: parseICalDate(currentEvent.dtend),
                    summary: currentEvent.summary || '√âv√©nement',
                    uid: currentEvent.uid
                });
            }
            currentEvent = null;
        } else if (currentEvent && line.includes(':')) {
            const [key, ...valueParts] = line.split(':');
            const value = valueParts.join(':');

            switch (key) {
                case 'DTSTART':
                case 'DTSTART;VALUE=DATE':
                    currentEvent.dtstart = value;
                    break;
                case 'DTEND':
                case 'DTEND;VALUE=DATE':
                    currentEvent.dtend = value;
                    break;
                case 'SUMMARY':
                    currentEvent.summary = value;
                    break;
                case 'UID':
                    currentEvent.uid = value;
                    break;
            }
        }
    }

    // Filtrer les √©v√©nements futurs et dans les prochains 3 mois
    const now = new Date();
    const threeMonthsLater = new Date();
    threeMonthsLater.setMonth(now.getMonth() + 3);

    return events.filter(event => {
        const eventStart = new Date(event.start);
        return eventStart >= now && eventStart <= threeMonthsLater;
    });
}

// Parser une date iCal
function parseICalDate(dateString) {
    // Format: YYYYMMDDTHHMMSSZ ou YYYYMMDD
    if (dateString.length === 8) {
        // Date seulement (YYYYMMDD)
        const year = parseInt(dateString.substr(0, 4));
        const month = parseInt(dateString.substr(4, 2)) - 1; // Mois 0-index√©
        const day = parseInt(dateString.substr(6, 2));
        return new Date(year, month, day);
    } else if (dateString.length >= 15) {
        // Date et heure (YYYYMMDDTHHMMSSZ)
        const year = parseInt(dateString.substr(0, 4));
        const month = parseInt(dateString.substr(4, 2)) - 1;
        const day = parseInt(dateString.substr(6, 2));
        const hour = parseInt(dateString.substr(9, 2));
        const minute = parseInt(dateString.substr(11, 2));
        const second = parseInt(dateString.substr(13, 2));

        if (dateString.endsWith('Z')) {
            // UTC
            return new Date(Date.UTC(year, month, day, hour, minute, second));
        } else {
            // Heure locale
            return new Date(year, month, day, hour, minute, second);
        }
    }

    // Fallback
    return new Date(dateString);
}

// V√©rifier si un cr√©neau est occup√©
function isSlotBusy(slotStart, slotEnd, events) {
    return events.some(event => {
        const eventStart = new Date(event.start);
        const eventEnd = new Date(event.end);

        // V√©rifier les chevauchements
        return (slotStart < eventEnd && slotEnd > eventStart);
    });
}

// Navigation entre les mois (mise √† jour)
async function navigateMonth(direction) {
    currentMonth.setMonth(currentMonth.getMonth() + direction);

    // Recharger les √©v√©nements si n√©cessaire
    await loadCalendarEvents();
    generateCalendar();
}

// G√©n√©ration du calendrier mensuel avec cr√©neaux
function generateCalendar() {
    const calendarGrid = document.getElementById('calendar-grid');
    const calendarTitle = document.getElementById('calendar-title');

    // Mettre √† jour le titre
    calendarTitle.textContent = currentMonth.toLocaleDateString('fr-FR', {
        month: 'long',
        year: 'numeric'
    });

    // Vider le calendrier
    calendarGrid.innerHTML = '';

    // Ajouter les en-t√™tes des jours
    const dayHeaders = ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'];
    dayHeaders.forEach(day => {
        const headerElement = document.createElement('div');
        headerElement.className = 'calendar-day-header';
        headerElement.textContent = day;
        calendarGrid.appendChild(headerElement);
    });

    // Calculer le premier jour du mois et le nombre de jours
    const firstDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1);
    const lastDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0);
    const startDate = new Date(firstDay);

    // Ajuster au lundi (jour 1 = lundi, jour 0 = dimanche)
    const dayOffset = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;
    startDate.setDate(startDate.getDate() - dayOffset);

    // G√©n√©rer 42 cellules (6 semaines)
    for (let i = 0; i < 42; i++) {
        const currentDate = new Date(startDate);
        currentDate.setDate(startDate.getDate() + i);

        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';

        // Marquer les jours hors du mois actuel
        if (currentDate.getMonth() !== currentMonth.getMonth()) {
            dayElement.classList.add('other-month');
        }

        // Marquer les jours pass√©s
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        if (currentDate < today) {
            dayElement.classList.add('past-day');
        }

        // V√©rifier si c'est un jour ouvrable
        const isWorkingDay = AVAILABILITY_RULES.workingDays.includes(currentDate.getDay());
        const isCurrentMonth = currentDate.getMonth() === currentMonth.getMonth();
        const isFuture = currentDate >= today;

        if (isWorkingDay && isCurrentMonth && isFuture) {
            // G√©n√©rer les cr√©neaux pour ce jour
            const slots = generateSlotsForDay(currentDate);

            dayElement.innerHTML = `
                <div class="day-number">${currentDate.getDate()}</div>
                <div class="day-slots">
                    ${slots.map(slot => {
                        let className = 'time-slot-mini ';
                        let tooltip = '';
                        let onclick = '';

                        if (slot.available) {
                            className += 'available';
                            tooltip = `${slot.time} - Disponible`;
                            onclick = `onclick="selectSlot('${slot.datetime}')"`;
                        } else if (slot.busy) {
                            className += 'busy';
                            tooltip = `${slot.time} - Occup√©`;
                        } else {
                            className += 'unavailable';
                            tooltip = `${slot.time} - Pass√©`;
                        }

                        return `
                            <div class="${className}"
                                 ${onclick}
                                 title="${tooltip}">
                                ${slot.time}
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        } else {
            dayElement.innerHTML = `<div class="day-number">${currentDate.getDate()}</div>`;
            if (!isWorkingDay) {
                dayElement.classList.add('weekend');
            }
        }

        calendarGrid.appendChild(dayElement);
    }
}

// G√©n√©rer les cr√©neaux pour un jour donn√© (avec v√©rification des √©v√©nements r√©els)
function generateSlotsForDay(date) {
    const slots = [];
    const events = eventsCache.data || [];

    AVAILABILITY_RULES.timeSlots.forEach(timeStr => {
        const [hours, minutes] = timeStr.split(':').map(Number);
        const slotStart = new Date(date);
        slotStart.setHours(hours, minutes, 0, 0);

        const slotEnd = new Date(slotStart);
        slotEnd.setMinutes(slotEnd.getMinutes() + AVAILABILITY_RULES.slotDuration);

        // V√©rifier si le cr√©neau n'est pas dans le pass√©
        const isNotPast = slotStart > new Date();

        // V√©rifier si le cr√©neau n'est pas occup√© par un √©v√©nement existant
        const isBusy = isSlotBusy(slotStart, slotEnd, events);

        // Le cr√©neau est disponible s'il n'est pas dans le pass√© ET pas occup√©
        const isAvailable = isNotPast && !isBusy;

        slots.push({
            time: timeStr,
            datetime: slotStart.toISOString(),
            available: isAvailable,
            busy: isBusy,
            date: date
        });
    });

    return slots;
}

// S√©lection d'un cr√©neau
function selectSlot(datetimeISO) {
    const slotDate = new Date(datetimeISO);
    selectedSlot = {
        date: slotDate,
        time: slotDate.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' }),
        datetime: datetimeISO
    };

    // Marquer visuellement le cr√©neau s√©lectionn√©
    document.querySelectorAll('.time-slot-mini').forEach(el => {
        el.classList.remove('selected');
    });
    event.currentTarget.classList.add('selected');

    // Mettre √† jour l'affichage du cr√©neau s√©lectionn√©
    document.getElementById('selected-slot-date').textContent =
        slotDate.toLocaleDateString('fr-FR', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });

    document.getElementById('selected-slot-time').textContent = selectedSlot.time;

    // Mettre √† jour l'affichage final pour l'√©tape 3
    document.getElementById('final-date-display').textContent =
        slotDate.toLocaleDateString('fr-FR', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });

    document.getElementById('final-time-display').textContent = selectedSlot.time;

    // Passer √† l'√©tape 2 apr√®s un court d√©lai
    setTimeout(() => {
        document.getElementById('step-1').classList.add('hidden');
        document.getElementById('step-2').classList.remove('hidden');
    }, 300);
}

// Navigation dans le processus de r√©servation
function goBackToCalendar() {
    document.getElementById('step-2').classList.add('hidden');
    document.getElementById('step-3').classList.add('hidden');
    document.getElementById('step-1').classList.remove('hidden');
}

function proceedToBookingForm() {
    if (!selectedSlot) {
        showNotification('Veuillez s√©lectionner un cr√©neau', 'error');
        return;
    }

    document.getElementById('step-2').classList.add('hidden');
    document.getElementById('step-3').classList.remove('hidden');
}

function confirmBooking() {
    // R√©cup√©rer les donn√©es du formulaire
    const name = document.getElementById('booking-name').value.trim();
    const phone = document.getElementById('booking-phone').value.trim();
    const email = document.getElementById('booking-email').value.trim();
    const subject = document.getElementById('booking-subject').value.trim();

    // Validation
    if (!name || !phone || !email) {
        showNotification('Veuillez remplir tous les champs obligatoires', 'error');
        return;
    }

    // Validation email
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        showNotification('Veuillez entrer une adresse email valide', 'error');
        return;
    }

    // Sauvegarder les donn√©es
    bookingData = {
        name,
        phone,
        email,
        subject,
        date: selectedSlot.date,
        time: selectedSlot.time,
        datetime: selectedSlot.datetime,
        type: 'phone',
        duration: 30
    };

    // Simuler l'envoi (remplacer par vraie logique backend)
    setTimeout(() => {
        // Afficher l'√©tape de confirmation
        document.getElementById('step-3').classList.add('hidden');
        document.getElementById('step-4').classList.remove('hidden');

        // Envoyer une notification
        showNotification('Demande de rendez-vous envoy√©e avec succ√®s !', 'success');

        // Logger pour debug (remplacer par envoi email/API)
        console.log('Nouveau rendez-vous:', bookingData);

        // Envoyer un email de confirmation (simulation)
        sendBookingConfirmation(bookingData);

    }, 1000);
}

function sendBookingConfirmation(data) {
    // Simulation d'envoi d'email de confirmation
    // Dans un vrai projet, ceci ferait appel √† votre backend/API

    const emailContent = `
Nouvelle demande de rendez-vous t√©l√©phonique :

üë§ Nom: ${data.name}
üìû T√©l√©phone: ${data.phone}
üìß Email: ${data.email}
üìÖ Date: ${data.date.toLocaleDateString('fr-FR')}
üïê Heure: ${data.time.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}
‚è±Ô∏è Dur√©e: ${data.duration} minutes
üìù Sujet: ${data.subject || 'Non sp√©cifi√©'}

Rendez-vous programm√© automatiquement via le portfolio.
    `;

    console.log('Email √† envoyer:', emailContent);

    // Ici vous pourriez utiliser:
    // - EmailJS pour envoyer des emails c√¥t√© client
    // - Votre API backend
    // - Un service comme Formspree, Netlify Forms, etc.
}

function addToCalendar() {
    if (!bookingData.date || !bookingData.time) return;

    const startTime = new Date(bookingData.time);
    const endTime = new Date(startTime.getTime() + (bookingData.duration * 60000));

    // Format pour Google Calendar
    const formatDate = (date) => {
        return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
    };

    const startFormatted = formatDate(startTime);
    const endFormatted = formatDate(endTime);

    const title = `Appel t√©l√©phonique avec ${bookingData.name}`;
    const details = `Appel t√©l√©phonique pr√©vu avec ${bookingData.name}\\n\\nT√©l√©phone: ${bookingData.phone}\\nEmail: ${bookingData.email}\\nSujet: ${bookingData.subject || 'Non sp√©cifi√©'}`;

    const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${startFormatted}/${endFormatted}&details=${encodeURIComponent(details)}`;

    window.open(googleCalendarUrl, '_blank');
}

// Int√©gration Google Calendar (am√©lior√©e)
function initGoogleCalendar() {
    console.log('Google Calendar integration ready');

    // √âcouter les changements de dates dans l'iframe (si possible)
    // Note: L'acc√®s au contenu de l'iframe Google Calendar est limit√© par CORS
    // Cette fonction pourrait √™tre √©tendue avec l'API Google Calendar
}

// Notification syst√®me (optionnel)
function showNotification(message, type = 'info') {
    // Cr√©er une notification toast style Apple
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;

    let iconClass = 'info-circle';
    if (type === 'success') iconClass = 'check-circle';
    else if (type === 'error') iconClass = 'exclamation-circle';
    else if (type === 'warning') iconClass = 'exclamation-triangle';

    notification.innerHTML = `
        <div class="notification-content">
            <i class="fas fa-${iconClass}"></i>
            <span>${message}</span>
        </div>
    `;

    document.body.appendChild(notification);

    // Animation d'entr√©e
    setTimeout(() => {
        notification.classList.add('show');
    }, 100);

    // Auto-suppression
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (document.body.contains(notification)) {
                document.body.removeChild(notification);
            }
        }, 300);
    }, 4000);
}

// Fonctions de contact direct
function contactViaLinkedIn() {
    const linkedinUrl = cvData.coordonnees.linkedin;
    const message = encodeURIComponent("Bonjour Prince, je vous contacte suite √† la consultation de votre portfolio.");

    // Ouvrir LinkedIn avec un message pr√©-rempli (si possible)
    window.open(linkedinUrl, '_blank');

    showNotification('Redirection vers LinkedIn pour vous connecter', 'info');
}

function contactViaEmail() {
    const email = cvData.coordonnees.email;
    const subject = encodeURIComponent("Contact depuis votre portfolio");
    const body = encodeURIComponent(`Bonjour Prince,

Je vous contacte suite √† la consultation de votre portfolio en ligne.

[Votre message ici]

Cordialement,`);

    const mailtoUrl = `mailto:${email}?subject=${subject}&body=${body}`;
    window.location.href = mailtoUrl;

    showNotification('Application mail ouverte', 'success');
}

function contactViaSMS() {
    const telephone = cvData.coordonnees.telephone;
    const message = encodeURIComponent("Bonjour Prince, je vous contacte suite √† votre portfolio.");

    // Cr√©er un lien SMS
    const smsUrl = `sms:${telephone}?body=${message}`;
    window.location.href = smsUrl;

    showNotification('Application SMS ouverte', 'success');
}

// Fonction pour WhatsApp (alternative au SMS)
function contactViaWhatsApp() {
    const telephone = cvData.coordonnees.telephone;
    const message = encodeURIComponent("Bonjour Prince, je vous contacte suite √† votre portfolio.");

    // Formater le num√©ro pour WhatsApp (supprimer le 0 initial et ajouter +33)
    const whatsappNumber = `33${telephone.substring(1)}`;
    const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${message}`;

    window.open(whatsappUrl, '_blank');
    showNotification('Redirection vers WhatsApp', 'info');
}

// Gestion des d√©tails d'exp√©rience
function openExperienceDetails(experienceIndex) {
    const experience = cvData.experiences[experienceIndex];
    if (!experience) {
        console.error('Exp√©rience non trouv√©e:', experienceIndex);
        return;
    }

    console.log('Ouverture des d√©tails pour:', experience.entreprise);

    // Remplir les informations de base
    document.getElementById('detail-company').textContent = experience.entreprise;
    document.getElementById('detail-position').textContent = experience.poste;
    document.getElementById('detail-period').textContent = experience.periode;
    document.getElementById('detail-location').textContent = experience.lieu;

    // Remplir les missions
    const missionsContainer = document.getElementById('detail-missions');
    missionsContainer.innerHTML = '';
    experience.missions.forEach(mission => {
        const li = document.createElement('li');
        li.textContent = mission;
        missionsContainer.appendChild(li);
    });

    // Si l'exp√©rience a des d√©tails √©tendus
    if (experience.details) {
        // Technologies
        const techContainer = document.getElementById('detail-technologies');
        techContainer.innerHTML = '';
        experience.details.technologies.forEach(tech => {
            const badge = document.createElement('span');
            badge.className = 'tech-badge';
            badge.textContent = tech;
            techContainer.appendChild(badge);
        });

        // R√©alisations
        const realisationsContainer = document.getElementById('detail-realisations');
        realisationsContainer.innerHTML = '';
        experience.details.realisations.forEach(realisation => {
            const li = document.createElement('li');
            li.textContent = realisation;
            realisationsContainer.appendChild(li);
        });

        // D√©fis
        const defisContainer = document.getElementById('detail-defis');
        defisContainer.innerHTML = '';
        experience.details.defis.forEach(defi => {
            const li = document.createElement('li');
            li.textContent = defi;
            defisContainer.appendChild(li);
        });

        // Environnement
        document.getElementById('detail-environnement').textContent = experience.details.environnement;

        // Impact
        document.getElementById('detail-impact').textContent = experience.details.impact;
    } else {
        // Si pas de d√©tails √©tendus, masquer ou remplir avec des valeurs par d√©faut
        document.getElementById('detail-technologies').innerHTML = '<span class="tech-badge">Informations √† venir</span>';
        document.getElementById('detail-realisations').innerHTML = '<li>D√©tails complets disponibles sur demande</li>';
        document.getElementById('detail-defis').innerHTML = '<li>Exp√©rience enrichissante avec de nombreux apprentissages</li>';
        document.getElementById('detail-environnement').textContent = 'Environnement professionnel dynamique';
        document.getElementById('detail-impact').textContent = 'Contribution significative aux objectifs de l\'entreprise';
    }

    // Ouvrir le modal
    const modal = document.getElementById('experience-details-modal');
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeExperienceDetails() {
    const modal = document.getElementById('experience-details-modal');
    modal.classList.remove('active');
    document.body.style.overflow = 'auto';
}

// Exportation pour utilisation en mode debug
window.debugPortfolio = debugPortfolio;